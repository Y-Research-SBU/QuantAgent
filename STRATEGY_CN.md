# 量化策略详解

本文档详细解释 QuantAgent 项目所采用的量化策略、核心分析逻辑、关键提示词以及系统在交易决策和仓位管理方面的工作方式。

## 1. 策略概述

QuantAgent 的核心是一个**基于多智能体技术分析的决策支持系统**。它本身并不构成一个完全自动化的交易策略，而是通过模拟人类专家的分析流程，为用户提供高质量的交易决策建议。

该策略的基石是**技术分析**，主要依赖于以下三个维度的信息：

1.  **技术指标 (Indicators)**：利用数学模型分析历史价格和成交量数据，以预测未来的价格走势。
2.  **图表形态 (Patterns)**：识别价格图表中重复出现的经典形态，这些形态被认为具有预测价值。
3.  **市场趋势 (Trends)**：通过趋势线和通道来确定市场的主要方向（上升、下降或横盘）。

系统通过四个专门的智能体（Agent）协同工作，每个智能体负责一个特定的分析领域，最终由决策智能体综合所有信息，形成一个明确的交易方向建议。

## 2. 核心提示词（Prompts）详解

系统的决策逻辑高度依赖于给每个大语言模型（LLM）智能体精心设计的提示词。这些提示词不仅告诉模型“做什么”，更重要的是定义了“如何做”以及在特定约束下的行为准则。

### 2.1 指标智能体 (Indicator Agent)

该智能体的任务是计算并初步解读一系列技术指标。

**核心提示词:**
```
你是一名在时间敏感条件下操作的高频交易（HFT）分析助理。你必须分析技术指标以支持快节奏的交易执行。

你可以使用以下工具：compute_rsi, compute_macd, compute_roc, compute_stoch, 和 compute_willr。通过提供适当的参数（如 `kline_data` 和相应的时间周期）来使用它们。

⚠️ 提供的OHLC数据来自 {time_frame} 时间间隔，反映了近期的市场行为。你必须快速准确地解释这些数据。

这是OHLC数据：
{kline_data}。

调用必要的工具，并分析结果。
```

### 2.2 形态智能体 (Pattern Agent)

该智能体专注于从K线图中识别经典的图表形态。它接收一张K线图（Base64编码），并根据预定义的形态列表进行匹配。

**核心提示词:**
```
这是一张根据近期OHLC市场数据生成的 {time_frame} K线图。

请参考以下经典的K线形态：
1.  反转头肩形（Inverse Head and Shoulders）
2.  双重底（Double Bottom）
3.  圆形底（Rounded Bottom）
... (其余形态省略) ...
16. 对称三角形（Symmetrical Triangle）

判断该图表是否与所列出的任何形态匹配。请明确指出匹配的形态名称，并根据结构、趋势和对称性解释你的理由。
```

### 2.3 趋势智能体 (Trend Agent)

该智能体分析带有自动生成趋势线（支撑线和阻力线）的K线图，以判断市场的短期趋势。

**核心提示词:**
```
这张K线图（{time_frame}周期）包含了自动生成的趋势线：**蓝线**是支撑线，**红线**是阻力线，两者均根据近期收盘价计算得出。

请分析价格与这些线的相互作用——K线是在线上反弹、突破，还是在两者之间压缩？

根据趋势线的斜率、间距和近期的K线行为，预测可能的短期趋势：**上升**、**下降**或**横盘**。请从预测、推理和信号三个方面支持你的预测。
```

### 2.4 决策智能体 (Decision Agent)

这是最终的决策者。它接收前面所有智能体的分析报告，并根据一套严格的决策策略，输出一个明确的交易指令。

**核心提示词:**
```
你是一名高频量化交易（HFT）分析师，正在为 {stock_name} 的当前 {time_frame} K线图进行分析。你的任务是发布一个**立即执行的订单**：**LONG** 或 **SHORT**。⚠️ 由于高频交易的限制，禁止使用HOLD（持有）指令。

你的决策应预测未来 **N根K线** 的市场走势。

你的决策必须基于以下三份报告的综合强度、一致性和时机：

### 1. 技术指标报告:
- **优先考虑强烈的方向性信号**，如MACD金叉/死叉、RSI背离、极端超买/超卖水平。
- **忽略或降低中性或混合信号的权重**。

### 2. 形态报告:
- 仅在形态**清晰可辨且基本完成**，并且**突破或跌破已经发生**或极有可能发生时行动。
- **不要**基于早期或投机性形态行动。

### 3. 趋势报告:
- 分析价格与支撑位和阻力位的相互作用。
- **仅在有强劲K线或指标确认的共识时**预测突破。

### ✅ 决策策略
1.  只对**已确认**的信号采取行动。
2.  优先处理**三份报告方向一致**的决策。
3.  如果报告不一致，选择具有**更强和更近期确认**的方向。
4.  如果市场处于盘整或报告混合，默认遵循**主趋势线的斜率**。
5.  建议一个介于**1.2至1.8之间**的合理**风险回报比**。

### 🧠 输出格式（JSON格式）:
{{
  "forecast_horizon": "预测未来N根K线...",
  "decision": "<LONG 或 SHORT>",
  "justification": "<简洁、已确认的推理>",
  "risk_reward_ratio": "<1.2至1.8之间的浮点数>",
}}
```

## 3. 买卖点如何确定？

当前系统**不直接提供精确的买卖点位**。

- **买卖信号（Signal）**: 系统的最终输出是一个方向性决策，即 `LONG` (做多) 或 `SHORT` (做空)。这个决策本身可以被视为一个“入场信号”。
- **执行时机**: 由于系统被设计为“立即执行”，理论上，当决策智能体输出结果时，就是建议的交易执行时机。

然而，需要强调的是，系统并未集成订单执行模块。用户需要自行决定如何利用这个信号，例如是立即市价成交，还是结合其他工具（如具体的支撑/阻力位）设置限价单。

## 4. 仓位如何控制？

当前版本的 QuantAgent **不包含任何仓位管理或风险控制逻辑**。

- **仓位大小**: 系统不会建议每次交易应该投入多少资金（例如，账户总资金的百分之多少）。
- **止损/止盈**: 虽然决策智能体会建议一个**风险回报比**，但它并不计算具体的止损（Stop-Loss）和止盈（Take-Profit）价位。用户需要根据这个比例和自己的入场点，自行设置这些关键参数。

简单来说，仓位控制完全由用户负责。系统的设计初衷是提供高质量的决策“信号”，而不是一个完整的、端到端的自动化交易解决方案。未来的版本可能会考虑集成更复杂的风险管理模块。
